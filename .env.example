# ==============================================================================
# Micros Monorepo - Consolidated Environment Configuration
# ==============================================================================
# Single source of truth for all service configuration.
# Copy this to .env.dev or .env.prod and customize as needed.
# ==============================================================================

# ------------------------------------------------------------------------------
# Deployment Mode
# ------------------------------------------------------------------------------
ENVIRONMENT=dev                           # dev or prod
COMPOSE_PROJECT_NAME=micros-dev           # Docker Compose project name (micros-dev or micros-prod)

# ------------------------------------------------------------------------------
# Database Ports (Host → Container)
# ------------------------------------------------------------------------------
MONGO_PORT=27017                          # Dev: 27017 (host), Prod: 10008
REDIS_PORT=6379                           # Dev: 6379 (host), Prod: 10009

# Database URIs (Internal Docker Network)
MONGODB_URI=mongodb://mongo:27017         # Dev: host.docker.internal, Prod: mongo
MONGODB_DATABASE=auth_db
REDIS_URL=redis://redis:6379              # Dev: host.docker.internal, Prod: redis

# ------------------------------------------------------------------------------
# Service Ports (Host → Container)
# Dev: 9000-9009, Prod: 10000-10009
# ------------------------------------------------------------------------------
AUTH_SERVICE_PORT=9005                    # Auth service: Dev 9005, Prod 10005 → container:3000
DOCUMENT_SERVICE_PORT=9007                # Document service: Dev 9007, Prod 10007 → container:8080
SECURE_FRONTEND_PORT=9006                 # Secure frontend: Dev 9006, Prod 10006 → container:8080

# ------------------------------------------------------------------------------
# Observability Stack Ports (Host → Container)
# Dev: 9000-9009, Prod: 10000-10009
# ------------------------------------------------------------------------------
PROMETHEUS_PORT=9000                      # Prometheus: Dev 9000, Prod 10000 → container:9090
LOKI_PORT=9001                           # Loki: Dev 9001, Prod 10001 → container:3100
GRAFANA_PORT=9002                        # Grafana: Dev 9002, Prod 10002 → container:3000
TEMPO_PORT=9003                          # Tempo: Dev 9003, Prod 10003 → container:3200
PROMTAIL_PORT=9004                       # Promtail: Dev 9004, Prod 10004 → container:9080

# ------------------------------------------------------------------------------
# Observability Credentials
# ------------------------------------------------------------------------------
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# ------------------------------------------------------------------------------
# Auth Service Configuration
# ------------------------------------------------------------------------------
SERVICE_NAME=auth-service
SERVICE_VERSION=0.1.0
LOG_LEVEL=info

# JWT Configuration
JWT_PRIVATE_KEY_PATH=keys/private.pem
JWT_PUBLIC_KEY_PATH=keys/public.pem
JWT_ACCESS_TOKEN_EXPIRY_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRY_DAYS=7
JWT_APP_TOKEN_EXPIRY_MINUTES=60

# Security Configuration
ALLOWED_ORIGINS=http://localhost:9097,http://localhost:3000
REQUIRE_SIGNATURES=false
ADMIN_API_KEY=dev-admin-key-change-in-production
ENABLE_SWAGGER=public                     # public, authenticated, or disabled

# Rate Limiting Configuration
RATE_LIMIT_LOGIN_ATTEMPTS=5
RATE_LIMIT_LOGIN_WINDOW_SECONDS=900
RATE_LIMIT_REGISTER_ATTEMPTS=3
RATE_LIMIT_REGISTER_WINDOW_SECONDS=3600
RATE_LIMIT_PASSWORD_RESET_ATTEMPTS=3
RATE_LIMIT_PASSWORD_RESET_WINDOW_SECONDS=3600
RATE_LIMIT_GLOBAL_IP_LIMIT=100
RATE_LIMIT_GLOBAL_IP_WINDOW_SECONDS=60
RATE_LIMIT_APP_TOKEN_LIMIT=10
RATE_LIMIT_APP_TOKEN_WINDOW_SECONDS=60

# Google OAuth Configuration (Optional)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:9096/auth/google/callback

# Gmail SMTP Configuration (Optional)
GMAIL_USER=your-email@gmail.com
GMAIL_APP_PASSWORD=your-gmail-app-password

# ------------------------------------------------------------------------------
# Document Service Configuration
# ------------------------------------------------------------------------------
DOCUMENT_SERVICE_NAME=document-service
DOCUMENT_SERVICE_LOG_LEVEL=info

# Storage Configuration
STORAGE_BACKEND=local                     # Local filesystem storage
STORAGE_LOCAL_PATH=./storage              # Path for local storage

# Document Processing Worker Configuration
WORKER_ENABLED=true                       # Enable background document processing
WORKER_COUNT=4                            # Number of worker threads
QUEUE_SIZE=100                            # Max jobs in queue
COMMAND_TIMEOUT_SECONDS=300               # Timeout for external commands (5 minutes)
TEMP_DIR=/tmp/document-processing         # Temporary directory for processing

# Signature Validation (Service-to-Service Auth)
REQUIRE_SIGNATURES=false                  # Set to true in production

# ------------------------------------------------------------------------------
# Secure Frontend Configuration
# ------------------------------------------------------------------------------
APP_SERVER__HOST=0.0.0.0
APP_SERVER__PORT=8080
APP_SERVER__SESSION_SECRET=change-this-to-a-secure-random-string-at-least-32-bytes

# Auth Service Integration
APP_AUTH_SERVICE__URL=http://auth-service:3000
APP_AUTH_SERVICE__CLIENT_ID=secure-frontend
APP_AUTH_SERVICE__SIGNING_SECRET=change-this-shared-secret-with-auth-service

# Document Service Integration
APP_DOCUMENT_SERVICE__URL=http://document-service:8080
APP_DOCUMENT_SERVICE__CLIENT_ID=secure-frontend
APP_DOCUMENT_SERVICE__SIGNING_SECRET=change-this-shared-secret-with-document-service

# ------------------------------------------------------------------------------
# OpenTelemetry Configuration
# ------------------------------------------------------------------------------
OTLP_ENDPOINT=http://tempo:4317
OTEL_SERVICE_NAME=                        # Set per service in docker-compose

# ------------------------------------------------------------------------------
# Payment Service Configuration
# ------------------------------------------------------------------------------
PAYMENT_SERVICE_HOST=0.0.0.0
PAYMENT_SERVICE_PORT=3003
PAYMENT_DATABASE_URL=mongodb://mongo:27017
PAYMENT_DATABASE_NAME=payment_db
